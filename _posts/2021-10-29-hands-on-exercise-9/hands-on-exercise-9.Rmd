---
title: "Hands-on Exercise 9"
description: |
  In this hands-on exercise, I learn how to calibrate geographicailly weighted regression models by using GWmodel package of R.
author:
  - name: Ngah Xin Yan
    url: https://github.com/nxinyan/
date: 10-29-2021
output:
  distill::distill_article:
    self_contained: false
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      eval = TRUE,
                      message = FALSE,
                      warning = FALSE,
                      fig.retina = 3)
```

# Overview

Geographically weighted regression (GWR) is a spatial statistical technique that takes non-stationary variables into consideration (e.g., climate; demographic factors; physical environment characteristics) and models the local relationships between these independent variables and an outcome of interest (also known as dependent variable). In this hands-on exercise, you will learn how to build hedonic pricing models by using GWR methods. The dependent variable is the resale prices of condominium in 2015. The independent variables are divided into either structural and locational.

## Data Used

The following datasets were used:

- URA Master Plan subzone boundary in shapefile format (i.e. MP14_SUBZONE_WEB_PL)
- condo_resale_2015 in csv format (i.e. condo_resale_2015.csv)

## Installing and Loading the R packages

- [**olsrr**](https://olsrr.rsquaredacademy.com/index.html): for building OLS and performing diagnostics tests

- [**GWmodel**](https://cran.r-project.org/web/packages/GWmodel/index.html): to calibrate geographical weighted family of models

- [**corrplot**](https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html)

- **sf**: spatial data handling

- **tidyverse**: attribute data handling

- **tmap**: choropleth mapping

```{r}
packages = c('olsrr', 'corrplot', 'ggpubr', 'sf', 'spdep', 'GWmodel', 'tmap', 'tidyverse')
for (p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p,character.only = T)
}
```

## Note on GWmodel

[**GWmodel**](https://cran.r-project.org/web/packages/GWmodel/index.html) package provides a collection of localised spatial statistical methods:

- GW summary statistics
- GW principal components analysis
- GW discriminant analysis
- various forms of GW regression (provided in basic or robust (outlier resistant) forms)

Commonly, outputs or parameters of the GWmodel are mapped to provide a useful exploratory tool, which can often precede (and direct) a more traditional or sophisticated statistical analysis.

# Geospatial Data Wrangling

## Importing geospatial data

*MP14_SUBZONE_WEB_PL* is the geospatial data used. It is in ESRI shapefile format.The shapefile consists of URA Master Plan 2014â€™s planning subzone boundaries. Polygon features are used to represent these geographic boundaries. The GIS data is in svy21 projected coordinates systems.

```{r}
mpsz = st_read(dsn = "data/geospatial", layer = "MP14_SUBZONE_WEB_PL")
```

Assigned the MP14_SUBZONE_WEB_PL shapefile to *mpsz*. It is a simple feature object. The geometry type is multipolygon. it is also important to note that mpsz simple feature object does not have EPSG information.

## Updating CRS information

```{r}
mpsz_svy21 <- st_transform(mpsz, 3414)
```

Verifiying the projection of the newly transformed *mpsz_svy21* by using st_crs() of sf package

```{r}
st_crs(mpsz_svy21)
```

Reveal extent of mpsz_svy21 using *st_bbox()* of sf package.

```{r}
st_bbox(mpsz_svy21)
```

# Aspatial Data Wrangling

## Importing the aspatial data

The *condo_resale_2015* is in csv file format. The codes chunk below uses *read_csv()* function of **readr** package to import *condo_resale_2015* into R as a tibble data frame called *condo_resale*.

```{r}
condo_resale = read_csv("data/aspatial/Condo_resale_2015.csv")
```

After importing the data file into R, it is important to examine if the data file has been imported correctly.

Learning more about the associated attribute information in the data frame. 

```{r}
glimpse(condo_resale)
```

To see the data in XCOORD column 

```{r}
head(condo_resale$LONGITUDE) 
```

To see the data in YCOORD column

```{r}
head(condo_resale$LATITUDE) 
```

```{r}
summary(condo_resale)
```

## Converting aspatial data frame into a sf object

The *condo resale* data frame is aspatial. Converting *condo_resale* data frame into a simple feature data frame by using *st_as_sf()*.

*st_transform()*  is also used to convert the coordinates from wgs84 to svy21

```{r}
condo_resale.sf <- st_as_sf(condo_resale,
                            coords = c("LONGITUDE", "LATITUDE"),
                            crs=4326) %>%
  st_transform(crs=3414)
head(condo_resale.sf)
```

# Exploratory Data Analysis

## EDA using statistical graphics

Plotting the distribution of SELLING_PRICE by using appropriate Exploratory Data Analysis (EDA)

```{r}
ggplot(data=condo_resale.sf, aes(x=`SELLING_PRICE`)) +
  geom_histogram(bins=20, color="black", fill="light blue")
```

More condominium units were transacted at a relative lower price as it is a right skewed distribution.

Statistically, the skewed dsitribution can be normalised by using log transformation

```{r}
condo_resale.sf <- condo_resale.sf %>%
  mutate(`LOG_SELLING_PRICE` = log(SELLING_PRICE))
```

Plot the ***LOG_SELLING_PRICE***

```{r}

```



